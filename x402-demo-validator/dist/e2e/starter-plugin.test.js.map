{"version":3,"sources":["../../e2e/starter-plugin.test.ts"],"sourcesContent":["import { character } from '../src/index.js';\nimport { v4 as uuidv4 } from 'uuid';\n\n// Define a minimal TestSuite interface that matches what's needed\ninterface TestSuite {\n  name: string;\n  description: string;\n  tests: Array<{\n    name: string;\n    fn: (runtime: any) => Promise<any>;\n  }>;\n}\n\n// Define minimal interfaces for the types we need\ntype UUID = `${string}-${string}-${string}-${string}-${string}`;\n\ninterface Memory {\n  entityId: UUID;\n  roomId: UUID;\n  content: {\n    text: string;\n    source: string;\n    actions?: string[];\n  };\n}\n\ninterface State {\n  values: Record<string, any>;\n  data: Record<string, any>;\n  text: string;\n}\n\ninterface Content {\n  text: string;\n  source?: string;\n  actions?: string[];\n}\n\nexport class StarterTestSuite implements TestSuite {\n  name = 'starter';\n  description = 'E2E tests for the starter project';\n\n  tests = [\n    {\n      name: 'Character configuration test',\n      fn: async (runtime: any) => {\n        const requiredFields = ['name', 'bio', 'plugins', 'system', 'messageExamples'];\n        const missingFields = requiredFields.filter((field) => !(field in character));\n\n        if (missingFields.length > 0) {\n          throw new Error(`Missing required fields: ${missingFields.join(', ')}`);\n        }\n\n        // Additional character property validations\n        if (character.name !== 'Eliza') {\n          throw new Error(`Expected character name to be 'Eliza', got '${character.name}'`);\n        }\n        if (!Array.isArray(character.plugins)) {\n          throw new Error('Character plugins should be an array');\n        }\n        if (!character.system) {\n          throw new Error('Character system prompt is required');\n        }\n        if (!Array.isArray(character.bio)) {\n          throw new Error('Character bio should be an array');\n        }\n        if (!Array.isArray(character.messageExamples)) {\n          throw new Error('Character message examples should be an array');\n        }\n      },\n    },\n    {\n      name: 'Plugin initialization test',\n      fn: async (runtime: any) => {\n        // Test plugin initialization with empty config\n        try {\n          await runtime.registerPlugin({\n            name: 'starter',\n            description: 'A starter plugin for Eliza',\n            init: async () => {},\n            config: {},\n          });\n        } catch (error) {\n          throw new Error(`Failed to register plugin: ${error.message}`);\n        }\n      },\n    },\n    {\n      name: 'Hello world action test',\n      fn: async (runtime: any) => {\n        const message: Memory = {\n          entityId: uuidv4() as UUID,\n          roomId: uuidv4() as UUID,\n          content: {\n            text: 'Can you say hello?',\n            source: 'test',\n            actions: ['HELLO_WORLD'], // Explicitly request the HELLO_WORLD action\n          },\n        };\n\n        const state: State = {\n          values: {},\n          data: {},\n          text: '',\n        };\n        let responseReceived = false;\n\n        // Test the hello world action\n        try {\n          await runtime.processActions(message, [], state, async (content: Content) => {\n            if (content.text === 'hello world!' && content.actions?.includes('HELLO_WORLD')) {\n              responseReceived = true;\n            }\n            return [];\n          });\n\n          if (!responseReceived) {\n            // Try directly executing the action if processActions didn't work\n            const helloWorldAction = runtime.actions.find((a) => a.name === 'HELLO_WORLD');\n            if (helloWorldAction) {\n              await helloWorldAction.handler(\n                runtime,\n                message,\n                state,\n                {},\n                async (content: Content) => {\n                  if (content.text === 'hello world!' && content.actions?.includes('HELLO_WORLD')) {\n                    responseReceived = true;\n                  }\n                  return [];\n                },\n                []\n              );\n            } else {\n              throw new Error('HELLO_WORLD action not found in runtime.actions');\n            }\n          }\n\n          if (!responseReceived) {\n            throw new Error('Hello world action did not produce expected response');\n          }\n        } catch (error) {\n          throw new Error(`Hello world action test failed: ${error.message}`);\n        }\n      },\n    },\n    {\n      name: 'Hello world provider test',\n      fn: async (runtime: any) => {\n        const message: Memory = {\n          entityId: uuidv4() as UUID,\n          roomId: uuidv4() as UUID,\n          content: {\n            text: 'What can you provide?',\n            source: 'test',\n          },\n        };\n\n        const state: State = {\n          values: {},\n          data: {},\n          text: '',\n        };\n\n        // Test the hello world provider\n        try {\n          if (!runtime.providers || runtime.providers.length === 0) {\n            throw new Error('No providers found in runtime');\n          }\n\n          // Find the specific provider we want to test\n          const helloWorldProvider = runtime.providers.find(\n            (p) => p.name === 'HELLO_WORLD_PROVIDER'\n          );\n\n          if (!helloWorldProvider) {\n            throw new Error('HELLO_WORLD_PROVIDER not found in runtime providers');\n          }\n\n          const result = await helloWorldProvider.get(runtime, message, state);\n\n          if (result.text !== 'I am a provider') {\n            throw new Error(`Expected provider to return \"I am a provider\", got \"${result.text}\"`);\n          }\n        } catch (error) {\n          throw new Error(`Hello world provider test failed: ${error.message}`);\n        }\n      },\n    },\n    {\n      name: 'Starter service test',\n      fn: async (runtime: any) => {\n        // Test service registration and lifecycle\n        try {\n          const service = runtime.getService('starter');\n          if (!service) {\n            throw new Error('Starter service not found');\n          }\n\n          if (\n            service.capabilityDescription !==\n            'This is a starter service which is attached to the agent through the starter plugin.'\n          ) {\n            throw new Error('Incorrect service capability description');\n          }\n\n          await service.stop();\n        } catch (error) {\n          throw new Error(`Starter service test failed: ${error.message}`);\n        }\n      },\n    },\n  ];\n}\n\n// Export a default instance of the test suite for the E2E test runner\nexport default new StarterTestSuite();\n"],"mappings":";;;;;AACA,SAAS,MAAM,cAAc;AAqCtB,IAAM,mBAAN,MAA4C;AAAA,EACjD,OAAO;AAAA,EACP,cAAc;AAAA,EAEd,QAAQ;AAAA,IACN;AAAA,MACE,MAAM;AAAA,MACN,IAAI,OAAO,YAAiB;AAC1B,cAAM,iBAAiB,CAAC,QAAQ,OAAO,WAAW,UAAU,iBAAiB;AAC7E,cAAM,gBAAgB,eAAe,OAAO,CAAC,UAAU,EAAE,SAAS,UAAU;AAE5E,YAAI,cAAc,SAAS,GAAG;AAC5B,gBAAM,IAAI,MAAM,4BAA4B,cAAc,KAAK,IAAI,CAAC,EAAE;AAAA,QACxE;AAGA,YAAI,UAAU,SAAS,SAAS;AAC9B,gBAAM,IAAI,MAAM,+CAA+C,UAAU,IAAI,GAAG;AAAA,QAClF;AACA,YAAI,CAAC,MAAM,QAAQ,UAAU,OAAO,GAAG;AACrC,gBAAM,IAAI,MAAM,sCAAsC;AAAA,QACxD;AACA,YAAI,CAAC,UAAU,QAAQ;AACrB,gBAAM,IAAI,MAAM,qCAAqC;AAAA,QACvD;AACA,YAAI,CAAC,MAAM,QAAQ,UAAU,GAAG,GAAG;AACjC,gBAAM,IAAI,MAAM,kCAAkC;AAAA,QACpD;AACA,YAAI,CAAC,MAAM,QAAQ,UAAU,eAAe,GAAG;AAC7C,gBAAM,IAAI,MAAM,+CAA+C;AAAA,QACjE;AAAA,MACF;AAAA,IACF;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,IAAI,OAAO,YAAiB;AAE1B,YAAI;AACF,gBAAM,QAAQ,eAAe;AAAA,YAC3B,MAAM;AAAA,YACN,aAAa;AAAA,YACb,MAAM,YAAY;AAAA,YAAC;AAAA,YACnB,QAAQ,CAAC;AAAA,UACX,CAAC;AAAA,QACH,SAAS,OAAO;AACd,gBAAM,IAAI,MAAM,8BAA8B,MAAM,OAAO,EAAE;AAAA,QAC/D;AAAA,MACF;AAAA,IACF;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,IAAI,OAAO,YAAiB;AAC1B,cAAM,UAAkB;AAAA,UACtB,UAAU,OAAO;AAAA,UACjB,QAAQ,OAAO;AAAA,UACf,SAAS;AAAA,YACP,MAAM;AAAA,YACN,QAAQ;AAAA,YACR,SAAS,CAAC,aAAa;AAAA;AAAA,UACzB;AAAA,QACF;AAEA,cAAM,QAAe;AAAA,UACnB,QAAQ,CAAC;AAAA,UACT,MAAM,CAAC;AAAA,UACP,MAAM;AAAA,QACR;AACA,YAAI,mBAAmB;AAGvB,YAAI;AACF,gBAAM,QAAQ,eAAe,SAAS,CAAC,GAAG,OAAO,OAAO,YAAqB;AAC3E,gBAAI,QAAQ,SAAS,kBAAkB,QAAQ,SAAS,SAAS,aAAa,GAAG;AAC/E,iCAAmB;AAAA,YACrB;AACA,mBAAO,CAAC;AAAA,UACV,CAAC;AAED,cAAI,CAAC,kBAAkB;AAErB,kBAAM,mBAAmB,QAAQ,QAAQ,KAAK,CAAC,MAAM,EAAE,SAAS,aAAa;AAC7E,gBAAI,kBAAkB;AACpB,oBAAM,iBAAiB;AAAA,gBACrB;AAAA,gBACA;AAAA,gBACA;AAAA,gBACA,CAAC;AAAA,gBACD,OAAO,YAAqB;AAC1B,sBAAI,QAAQ,SAAS,kBAAkB,QAAQ,SAAS,SAAS,aAAa,GAAG;AAC/E,uCAAmB;AAAA,kBACrB;AACA,yBAAO,CAAC;AAAA,gBACV;AAAA,gBACA,CAAC;AAAA,cACH;AAAA,YACF,OAAO;AACL,oBAAM,IAAI,MAAM,iDAAiD;AAAA,YACnE;AAAA,UACF;AAEA,cAAI,CAAC,kBAAkB;AACrB,kBAAM,IAAI,MAAM,sDAAsD;AAAA,UACxE;AAAA,QACF,SAAS,OAAO;AACd,gBAAM,IAAI,MAAM,mCAAmC,MAAM,OAAO,EAAE;AAAA,QACpE;AAAA,MACF;AAAA,IACF;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,IAAI,OAAO,YAAiB;AAC1B,cAAM,UAAkB;AAAA,UACtB,UAAU,OAAO;AAAA,UACjB,QAAQ,OAAO;AAAA,UACf,SAAS;AAAA,YACP,MAAM;AAAA,YACN,QAAQ;AAAA,UACV;AAAA,QACF;AAEA,cAAM,QAAe;AAAA,UACnB,QAAQ,CAAC;AAAA,UACT,MAAM,CAAC;AAAA,UACP,MAAM;AAAA,QACR;AAGA,YAAI;AACF,cAAI,CAAC,QAAQ,aAAa,QAAQ,UAAU,WAAW,GAAG;AACxD,kBAAM,IAAI,MAAM,+BAA+B;AAAA,UACjD;AAGA,gBAAM,qBAAqB,QAAQ,UAAU;AAAA,YAC3C,CAAC,MAAM,EAAE,SAAS;AAAA,UACpB;AAEA,cAAI,CAAC,oBAAoB;AACvB,kBAAM,IAAI,MAAM,qDAAqD;AAAA,UACvE;AAEA,gBAAM,SAAS,MAAM,mBAAmB,IAAI,SAAS,SAAS,KAAK;AAEnE,cAAI,OAAO,SAAS,mBAAmB;AACrC,kBAAM,IAAI,MAAM,uDAAuD,OAAO,IAAI,GAAG;AAAA,UACvF;AAAA,QACF,SAAS,OAAO;AACd,gBAAM,IAAI,MAAM,qCAAqC,MAAM,OAAO,EAAE;AAAA,QACtE;AAAA,MACF;AAAA,IACF;AAAA,IACA;AAAA,MACE,MAAM;AAAA,MACN,IAAI,OAAO,YAAiB;AAE1B,YAAI;AACF,gBAAM,UAAU,QAAQ,WAAW,SAAS;AAC5C,cAAI,CAAC,SAAS;AACZ,kBAAM,IAAI,MAAM,2BAA2B;AAAA,UAC7C;AAEA,cACE,QAAQ,0BACR,wFACA;AACA,kBAAM,IAAI,MAAM,0CAA0C;AAAA,UAC5D;AAEA,gBAAM,QAAQ,KAAK;AAAA,QACrB,SAAS,OAAO;AACd,gBAAM,IAAI,MAAM,gCAAgC,MAAM,OAAO,EAAE;AAAA,QACjE;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;AAGA,IAAO,8BAAQ,IAAI,iBAAiB;","names":[]}